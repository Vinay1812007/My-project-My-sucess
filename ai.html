<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/style.css">
</head>
<body>

<div class="header">AI Assistant</div>

<div id="aiChat" class="safe-bottom" style="padding:16px"></div>

<div class="glass" style="
  position:fixed;
  bottom:70px;
  width:100%;
  padding:12px;
  display:flex;
  gap:10px;
">
  <input id="aiInput" placeholder="Ask anythingâ€¦" />
  <button class="button" onclick="sendAI()">âž¤</button>
</div>

<div class="tab-bar">
  <div class="tab-item" onclick="go('index.html')">Home</div>
  <div class="tab-item" onclick="go('chatgram.html')">Chat</div>
  <div class="tab-item" onclick="go('music.html')">Music</div>
  <div class="tab-item active">AI</div>
</div>

<script>
const chat = document.getElementById("aiChat");
let history = JSON.parse(localStorage.aiHistory || "[]");

history.forEach(addBubble);

function addBubble({ role, text }) {
  const div = document.createElement("div");
  div.className = "bubble " + (role === "user" ? "blue" : "gray");
  div.innerHTML = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

async function sendAI() {
  const q = aiInput.value.trim();
  if (!q) return;
  aiInput.value = "";

  const userMsg = { role: "user", text: q };
  history.push(userMsg);
  addBubble(userMsg);

  const aiMsg = { role: "ai", text: "â€¦" };
  addBubble(aiMsg);

  // Streaming feel (simulated token stream)
  const response = await fetch(
    "https://api.allorigins.win/raw?url=" +
    encodeURIComponent("https://api.duckduckgo.com/?q=" + q + "&format=json")
  );
  const data = await response.json();
  const answer = data.AbstractText || "I couldn't find a direct answer.";

  let i = 0;
  aiMsg.text = "";
  const interval = setInterval(() => {
    aiMsg.text += answer[i++] || "";
    chat.lastChild.innerHTML = aiMsg.text;
    if (i >= answer.length) {
      clearInterval(interval);
      history.push(aiMsg);
      localStorage.aiHistory = JSON.stringify(history);
    }
  }, 20);
}

/* Voice Input */
if ("webkitSpeechRecognition" in window) {
  const mic = document.createElement("button");
  mic.textContent = "ðŸŽ¤";
  mic.className = "button";
  mic.onclick = () => {
    const r = new webkitSpeechRecognition();
    r.onresult = e => aiInput.value = e.results[0][0].transcript;
    r.start();
  };
  document.querySelector(".glass").appendChild(mic);
}
</script>

<script src="/script.js"></script>
</body>
</html>
