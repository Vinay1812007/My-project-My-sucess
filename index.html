<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Vinay AI Assistant âœ¨</title>

<style>
/* ===== RESET ===== */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

/* ===== BODY ===== */
body {
  height: 100vh;
  background: linear-gradient(180deg, #0b1220, #05070d);
  display: flex;
  flex-direction: column;
  color: #fff;
}

/* ===== HEADER ===== */
header {
  padding: 14px;
  text-align: center;
  font-weight: 600;
  backdrop-filter: blur(18px);
  background: rgba(255,255,255,0.08);
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

/* ===== CHAT ===== */
#chat {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
}

/* ===== BUBBLES ===== */
.user, .bot {
  max-width: 80%;
  margin-bottom: 12px;
  padding: 12px 14px;
  border-radius: 16px;
  line-height: 1.4;
  word-wrap: break-word;
}

.user {
  margin-left: auto;
  background: #2563eb;
}

.bot {
  margin-right: auto;
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(14px);
  position: relative;
}

/* ===== SPEAKER ===== */
.bot .speaker {
  cursor: pointer;
  font-size: 14px;
  opacity: 0.7;
  margin-left: 6px;
}

.bot .speaker:hover {
  opacity: 1;
}

/* ===== INPUT BAR (NO BLUR = FIXED) ===== */
footer {
  padding: 10px;
  display: flex;
  gap: 8px;
  background: #050a18;
  border-top: 1px solid rgba(255,255,255,0.1);
}

#model {
  padding: 8px;
  border-radius: 12px;
  border: none;
  background: rgba(255,255,255,0.15);
  color: #fff;
}

#input {
  flex: 1;
  padding: 12px;
  border-radius: 18px;
  border: none;
  outline: none;
  background: rgba(255,255,255,0.15);
  color: #fff;
  font-size: 16px;

  /* MOBILE TYPING FIX */
  transform: translateZ(0);
  -webkit-appearance: none;
}

button {
  width: 44px;
  border-radius: 50%;
  border: none;
  cursor: pointer;
  background: #2563eb;
  color: white;
  font-size: 18px;
}

/* ===== MOBILE ===== */
@media (max-width: 600px) {
  .user, .bot {
    max-width: 90%;
  }
}
</style>
</head>

<body>

<header>Vinay AI Assistant âœ¨</header>

<div id="chat"></div>

<footer>
  <select id="model">
    <option value="groq">Groq</option>
    <option value="gemini">Gemini</option>
  </select>

  <input id="input" placeholder="Type here..." autocomplete="off" />
  <button id="send">âž¤</button>
</footer>

<script>
/* ==============================
   ELEMENTS
================================ */
const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("send");
const modelSel = document.getElementById("model");

/* ==============================
   VOICE (BEST POSSIBLE)
================================ */
let selectedVoice = null;

/* Load best available voice */
function loadBestVoice() {
  const voices = speechSynthesis.getVoices();

  selectedVoice =
    voices.find(v => v.name.includes("Google US English")) ||
    voices.find(v => v.name.includes("Google")) ||
    voices.find(v => v.lang === "en-US") ||
    voices[0];
}

speechSynthesis.onvoiceschanged = loadBestVoice;

/* Speak */
function speak(text) {
  speechSynthesis.cancel();

  const utterance = new SpeechSynthesisUtterance(text);
  utterance.voice = selectedVoice;
  utterance.lang = "en-US";

  /* ChatGPT-like tuning */
  utterance.rate = 1.0;
  utterance.pitch = 1.0;
  utterance.volume = 1.0;

  speechSynthesis.speak(utterance);
}

/* Stop sound when typing */
input.addEventListener("input", () => {
  speechSynthesis.cancel();
});

/* ==============================
   CHAT UI
================================ */
function addBubble(text, cls) {
  const div = document.createElement("div");
  div.className = cls;

  if (cls === "bot") {
    const msg = document.createElement("span");
    msg.textContent = text;

    const speaker = document.createElement("span");
    speaker.textContent = " ðŸ”Š";
    speaker.className = "speaker";
    speaker.onclick = () => speak(text);

    div.appendChild(msg);
    div.appendChild(speaker);
  } else {
    div.textContent = text;
  }

  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

/* ==============================
   SEND MESSAGE
================================ */
async function sendMessage() {
  const msg = input.value.trim();
  if (!msg) return;

  addBubble(msg, "user");
  input.value = "";

  addBubble("Thinkingâ€¦", "bot");

  try {
    const res = await fetch("/api/ai", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        message: msg,
        model: modelSel.value
      })
    });

    const data = await res.json();
    chat.lastChild.remove();
    addBubble(data.reply || "No response", "bot");

  } catch (e) {
    chat.lastChild.remove();
    addBubble("Error: API not responding", "bot");
  }
}

sendBtn.onclick = sendMessage;
input.addEventListener("keydown", e => {
  if (e.key === "Enter") sendMessage();
});
</script>

</body>
</html>
